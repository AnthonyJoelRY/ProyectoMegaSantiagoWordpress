<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MegaSantiago | Carrito</title>

    <!-- CSS: desde View → Model -->
    <link rel="stylesheet" href="../Model/csss estilos/estilos.css">
</head>
<body>

    <!-- BARRA SUPERIOR -->
    <div class="top-bar">
        <p>ENCUENTRA DE TODO EN MEGASANTIAGO - OFERTAS DEL MES</p>
    </div>

    <!-- HEADER -->
    <header class="main-header">
        <div class="header-left">
            <a href="../index.html">
                <!-- Logo: View → Model/imagenes -->
                <img src="../Model/imagenes/Logo_MegaSantiago.png" alt="MegaSantiago" class="logo-mega">
            </a>
        </div>

        <div class="header-center">
            <h1 class="auth-header-title">Carrito de compras</h1>
        </div>

        <div class="header-right">
            <a href="../index.html" class="link-header">← Seguir comprando</a>
        </div>
    </header>

    <!-- CONTENIDO CARRITO -->
    <main class="cart-page">
        <section class="cart-container">

            <h2>Resumen de tu carrito</h2>

            <div id="cart-vacio" class="cart-vacio">
                Tu carrito está vacío. Agrega productos desde la página principal.
            </div>

            <div id="cart-contenido" class="cart-contenido">
                <table class="cart-tabla">
                    <thead>
                        <tr>
                            <th>Producto</th>
                            <th>Precio unit.</th>
                            <th>Cantidad</th>
                            <th>Subtotal</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="tbodyCarrito">
                        <!-- filas generadas por JS -->
                    </tbody>
                </table>

                <div class="cart-footer">
                    <button id="btnVaciar" class="btn-cart-secondary">Vaciar carrito</button>

                    <div class="cart-total">
                        <span>Total:</span>
                        <strong id="totalCarrito">$0,00</strong>
                    </div>
                </div>

                <button class="btn-cart-primary">
                    Finalizar compra (demo)
                </button>
            </div>

        </section>
    </main>

    <footer class="footer">
        <p>MegaSantiago © 2025 - Todos los derechos reservados</p>
    </footer>

    <script>
        // ----- LÓGICA DEL CARRITO EN LA PÁGINA CARRITO -----
        function obtenerCarrito() {
            return JSON.parse(localStorage.getItem('carritoMega') || '[]');
        }

        function guardarCarrito(carrito) {
            localStorage.setItem('carritoMega', JSON.stringify(carrito));
        }

        function formatearDinero(valor) {
            return '$' + valor.toFixed(2);
        }

        function renderCarrito() {
            const tbody = document.getElementById('tbodyCarrito');
            const divVacio = document.getElementById('cart-vacio');
            const divContenido = document.getElementById('cart-contenido');
            const spanTotal = document.getElementById('totalCarrito');

            let carrito = obtenerCarrito();

            tbody.innerHTML = '';

            if (carrito.length === 0) {
                divVacio.style.display = 'block';
                divContenido.style.display = 'none';
                spanTotal.textContent = '$0,00';
                return;
            }

            divVacio.style.display = 'none';
            divContenido.style.display = 'block';

            let total = 0;

            carrito.forEach(item => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.nombre}</td>
                    <td>${formatearDinero(item.precio)}</td>
                    <td>
                        <input type="number" min="1" value="${item.cantidad}"
                               class="cart-cantidad" data-id="${item.id}">
                    </td>
                    <td>${formatearDinero(subtotal)}</td>
                    <td>
                        <button class="btn-cart-delete" data-id="${item.id}">✕</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            spanTotal.textContent = formatearDinero(total);
        }

        // Cambiar cantidad
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('cart-cantidad')) {
                const id = e.target.getAttribute('data-id');
                let nuevaCantidad = parseInt(e.target.value, 10);
                if (isNaN(nuevaCantidad) || nuevaCantidad < 1) nuevaCantidad = 1;
                e.target.value = nuevaCantidad;

                let carrito = obtenerCarrito();
                const item = carrito.find(p => p.id === id);
                if (item) {
                    item.cantidad = nuevaCantidad;
                    guardarCarrito(carrito);
                    renderCarrito();
                }
            }
        });

        // Eliminar producto
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn-cart-delete')) {
                const id = e.target.getAttribute('data-id');
                let carrito = obtenerCarrito();
                carrito = carrito.filter(p => p.id !== id);
                guardarCarrito(carrito);
                renderCarrito();
            }
        });

        // Vaciar carrito
        document.getElementById('btnVaciar').addEventListener('click', function() {
            if (confirm('¿Seguro que quieres vaciar el carrito?')) {
                localStorage.removeItem('carritoMega');
                renderCarrito();
            }
        });

        // Inicializar
        renderCarrito();
    </script>

</body>
</html>
